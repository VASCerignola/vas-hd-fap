<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>VAS-HD (FAP)</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#c86a9a">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
:root{
  --bg:#120b10;--card:#1b0f17;--line:#6b2b4a;
  --txt:#f2e9ee;--mut:#d6b3c4;--accent:#c86a9a;
  --gap:20px;--pad:18px;--radius:16px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:-apple-system,system-ui;background:var(--bg);color:var(--txt)}
.hidden{display:none}

.step-bg{
  min-height:100vh;
  background-size:cover;
  background-position:center;
  position:relative;
}
.step-bg::before{
  content:"";position:absolute;inset:0;background:rgba(18,11,16,.75)
}
.step-bg>*{position:relative;z-index:1}

.bg-nurse{background-image:url('bg-nurse.jpg')}
.bg-patient{background-image:url('bg-patient.jpg')}
.bg-access{background-image:url('bg-access.jpg')}
.bg-checklist{background-image:url('bg-checklist.jpg')}
.bg-result{background-image:url('bg-result.jpg')}

header{padding:14px;border-bottom:1px solid var(--line)}
main{padding:14px;max-width:900px;margin:auto}

.card{
  background:rgba(27,15,23,.95);
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:var(--pad);
  margin-bottom:14px;
}

label{display:block;color:var(--mut);margin:18px 0 8px}
input,select{
  width:100%;padding:18px;font-size:16px;
  border-radius:14px;border:1px solid var(--line);
  background:#0f0a0d;color:var(--txt)
}

.btn,.btn2{
  width:100%;padding:16px;border-radius:16px;
  font-weight:900;font-size:16px
}
.btn{background:var(--accent);color:white;border:0}
.btn2{background:transparent;color:var(--txt);border:1px solid var(--line)}

.badge{padding:12px 18px;border-radius:999px;font-weight:900;color:white}
.g0{background:#3b7d5b}.g1{background:#b58b2a}
.g2{background:#c46a2d}.g3{background:#b11226}

.alert{margin-top:14px;padding:14px;border-radius:14px;font-weight:900}
.alert.red{background:#b11226}

.progress{margin-bottom:12px;color:var(--mut);font-weight:800}
.block{margin-top:var(--gap)}
.block.hidden{display:none}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash" onclick="enterApp()" style="position:fixed;inset:0;background:#120b10;display:flex;align-items:center;justify-content:center;z-index:9999">
  <img src="splash.png" style="max-width:100%;max-height:100%">
</div>

<div id="app" class="hidden">

<header>
  <h1>VAS-HD (FAP)</h1>
  <small>ðŸ©¸ Sorveglianza accessi vascolari</small>
</header>

<main id="home">
  <div class="card">
    <b>Storico sedute</b>
    <div id="history" style="margin-top:12px;color:var(--mut)">â€”</div>
    <div style="display:flex;gap:10px;margin-top:12px">
      <button class="btn2" onclick="exportCSV()">ðŸ“¤ Excel</button>
      <button class="btn2" onclick="shareCSV()">ðŸŸ¢ WhatsApp</button>
    </div>
  </div>
  <button class="btn" onclick="startWizard()">âž• Nuova seduta</button>
</main>

<section id="s1" class="hidden step-bg bg-nurse">
<main>
  <div class="card">
    <label>Infermiere</label>
    <input id="nurse">
    <button class="btn" onclick="next1()">Avanti</button>
  </div>
</main>
</section>

<section id="s2" class="hidden step-bg bg-patient">
<main>
  <div class="card">
    <label>ID Paziente</label>
    <input id="pid">
    <button class="btn" onclick="next2()">Avanti</button>
  </div>
</main>
</section>

<section id="s3" class="hidden step-bg bg-access">
<main>
  <div class="card">
    <label>Tipo accesso</label>
    <select id="accesso">
      <option value="">â€”</option>
      <option value="FAV">FAV</option>
      <option value="AVG">AVG</option>
      <option value="CVC">CVC</option>
    </select>
    <button class="btn" onclick="next3()">Avanti</button>
  </div>
</main>
</section>

<section id="s4" class="hidden step-bg bg-checklist">
<main>
  <div class="card">
    <div id="prog" class="progress"></div>

    <div id="flowAV" class="hidden">
      <label>Qb</label><select id="av_qb"><option></option><option value="ok">â‰¥95%</option><option value="mid">85â€“94%</option><option value="low">&lt;85%</option></select>
      <label>Allarmi</label><select id="av_alarm"><option></option><option value="no">No</option><option value="single">Intermittenti</option><option value="many">Frequenti</option></select>
      <label>PA</label><select id="av_pa"><option></option><option value="ok">Normale</option><option value="warn">Occasionali</option><option value="bad">Frequenti</option></select>
      <label>PV</label><select id="av_pv"><option></option><option value="ok">Normale</option><option value="warn">Occasionali</option><option value="bad">Frequenti</option></select>
      <label>Cannulazione</label><select id="av_cann"><option></option><option value="ok">Facile</option><option value="diff">Difficile</option><option value="imp">Impossibile</option></select>
      <label>Sanguinamento</label><select id="av_bleed"><option></option><option value="ok">Normale</option><option value="prol">Prolungato</option><option value="mass">Molto prolungato</option></select>
      <label>Segni locali</label><select id="av_note"><option></option><option value="Nessuno">Nessuno</option><option value="Thrill/Bruit modificato">Thrill/Bruit</option><option value="Ischemia/steal sospetta">Steal</option></select>
      <div id="avgOnly" class="hidden">
        <label>Graft</label><select id="avg_skin"><option></option><option value="ok">OK</option><option value="warn">Sospetto</option><option value="crit">Critico</option></select>
      </div>
    </div>

    <div id="flowCVC" class="hidden">
      <label>Lumi</label><select id="cvc_lumen"><option></option><option value="ok">OK</option><option value="one">1 lume</option><option value="two">2 lumi</option></select>
      <label>Qb</label><select id="cvc_qb"><option></option><option value="ok">â‰¥95%</option><option value="mid">85â€“94%</option><option value="low">&lt;85%</option></select>
      <label>Allarmi</label><select id="cvc_alarm"><option></option><option value="no">No</option><option value="single">Intermittenti</option><option value="many">Frequenti</option></select>
      <label>PA</label><select id="cvc_pa"><option></option><option value="ok">Normale</option><option value="warn">Occasionali</option><option value="bad">Frequenti</option></select>
      <label>PV</label><select id="cvc_pv"><option></option><option value="ok">Normale</option><option value="warn">Occasionali</option><option value="bad">Frequenti</option></select>
      <label>Inversione linee</label><select id="cvc_reverse"><option></option><option value="no">No</option><option value="yes">SÃ¬</option></select>
      <label>Exit-site</label><select id="cvc_exit"><option></option><option value="ok">OK</option><option value="red">Rosso</option><option value="pus">Essudato</option></select>
      <label>Febbre</label><select id="cvc_sys"><option></option><option value="no">No</option><option value="yes">SÃ¬</option></select>
    </div>

    <button class="btn" onclick="calc()">Calcola</button>
  </div>
</main>
</section>

<section id="s5" class="hidden step-bg bg-result">
<main>
  <div class="card">
    <div id="result"></div>
    <div id="medBlock" class="alert red hidden">
      Medico informato?
      <select id="medicoInf"><option></option><option value="si">SÃ¬</option></select>
    </div>
    <button class="btn" onclick="finish()">Fine</button>
  </div>
</main>
</section>

</div>

<script>
const STATE={nurse:"",pid:"",accesso:""};
let LAST={grade:0};

function enterApp(){splash.style.display="none";app.classList.remove("hidden");}
function startWizard(){home.classList.add("hidden");go("s1");}
function go(id){document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));document.getElementById(id).classList.remove("hidden");}

function next1(){if(!nurse.value)return alert("Infermiere");STATE.nurse=nurse.value;go("s2")}
function next2(){if(!pid.value)return alert("Paziente");STATE.pid=pid.value;go("s3")}
function next3(){
  if(!accesso.value)return alert("Accesso");
  STATE.accesso=accesso.value;
  flowAV.classList.add("hidden");flowCVC.classList.add("hidden");avgOnly.classList.add("hidden");
  if(STATE.accesso==="CVC") flowCVC.classList.remove("hidden");
  else {flowAV.classList.remove("hidden"); if(STATE.accesso==="AVG") avgOnly.classList.remove("hidden");}
  go("s4");
}

function calc(){
  let g=0;
  if(STATE.accesso==="CVC"){
    if(cvc_qb.value==="low"||cvc_alarm.value==="many")g=2;
    if(cvc_lumen.value==="two"||cvc_exit.value==="pus"||cvc_sys.value==="yes")g=3;
  }else{
    if(av_qb.value==="low"||av_alarm.value==="many")g=2;
    if(av_cann.value==="imp"||av_note.value.includes("Steal"))g=3;
  }
  LAST.grade=g;
  result.innerHTML=`<span class="badge g${g}">G${g}</span>`;
  medBlock.classList.toggle("hidden",g<2);
  go("s5");
}

function finish(){
  resetForNext();
  go("s2");
}

function resetForNext(){
  pid.value="";accesso.value="";
  document.querySelectorAll("select").forEach(s=>s.value="");
  medBlock.classList.add("hidden");
}

function exportCSV(){alert("Export attivo")}
function shareCSV(){alert("Share attivo")}
</script>

</body>
</html>
