<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VAS-HD (FAP)</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#c86a9a">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
:root{
  --bg:#120b10;--card:#1b0f17;--line:#6b2b4a;
  --txt:#f2e9ee;--mut:#d6b3c4;--accent:#c86a9a;
}
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,system-ui;background:var(--bg);color:var(--txt)}
.hidden{display:none}
/* === BACKGROUND PER STEP (FIX DEFINITIVO) === */
.step-bg{
  position:relative;
  min-height:100vh;
  background-size:cover;
  background-position:center;
}

.step-bg::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(18,11,16,0.75);
}

.step-bg > *{
  position:relative;
  z-index:1;
}

.bg-nurse{ background-image:url('bg-nurse.jpg'); }
.bg-patient{ background-image:url('bg-patient.jpg'); }
.bg-access{ background-image:url('bg-access.jpg'); }
.bg-checklist{ background-image:url('bg-checklist.jpg'); }
.bg-result{ background-image:url('bg-result.jpg'); }

/* SPLASH */
#splash{position:fixed;inset:0;background:#120b10;display:flex;align-items:center;justify-content:center;z-index:9999}
#splash img{max-width:100%;max-height:100%;object-fit:contain}

/* APP UI */
header{padding:14px;border-bottom:1px solid var(--line)}
h1{margin:0;font-size:20px}
small{color:var(--mut)}
main{padding:14px;max-width:980px;margin:0 auto}
.card{border:1px solid var(--line);border-radius:16px;padding:14px;margin-bottom:12px;background:rgba(27,15,23,0.92)}
.grid{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:780px){.grid{grid-template-columns:1fr 1fr}}
label{font-size:12px;color:var(--mut);display:block;margin-bottom:6px}
select,input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0f0a0d;color:var(--txt)}
.row{display:flex;gap:10px}
.btn{width:100%;padding:14px;border-radius:14px;border:0;font-weight:900;background:var(--accent);color:white}
.btn2{width:100%;padding:14px;border-radius:14px;border:1px solid var(--line);font-weight:900;background:transparent;color:var(--txt)}
.badge{display:inline-block;padding:6px 12px;border-radius:999px;font-weight:900;color:white}
.g0{background:#3b7d5b}.g1{background:#b58b2a}.g2{background:#c46a2d}.g3{background:#b11226}
.kpi{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.pill{border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--mut);font-weight:800}
hr{border:0;border-top:1px solid var(--line);margin:12px 0}

/* Alert */
.alert{padding:12px;border-radius:12px;margin-top:10px;font-weight:900}
.alert.red{background:#b11226}

/* Sirena */
@keyframes blink{0%{opacity:1}50%{opacity:.2}100%{opacity:1}}
.siren{animation:blink 1s infinite;text-align:center}
.flash{animation:blink .25s 3}

/* Titoli step */
.stepTitle{font-weight:900;font-size:16px}
.stepSub{color:var(--mut);margin-top:4px}

/* === BACKGROUND PER STEP === */
.step-bg{
  position:relative;
  min-height:100vh;
  background-size:cover;
  background-position:center;
}
.step-bg::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(18,11,16,0.75);
}
.step-bg > *{position:relative;z-index:1}

/* immagini specifiche */
.bg-nurse{ background-image:url('bg-nurse.jpg'); }
.bg-patient{ background-image:url('bg-patient.jpg'); }
.bg-access{ background-image:url('bg-access.jpg'); }
.bg-checklist{ background-image:url('bg-checklist.jpg'); }
.bg-result{ background-image:url('bg-result.jpg'); }
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash" onclick="enterApp()">
  <img src="splash.png" alt="VAS-HD">
</div>

<div id="app" class="hidden">
  <header>
    <h1>VAS-HD (FAP)</h1>
    <small>ğŸ©¸ Sorveglianza accessi vascolari â€“ wizard a cascata</small>
  </header>

  <main>

    <!-- HOME -->
    <section id="home">
      <div class="card">
        <div class="stepTitle">ğŸ“‹ Ultime sedute</div>
        <div id="history" style="margin-top:10px;color:var(--mut)">Nessuna seduta.</div>
        <div class="row" style="margin-top:10px">
          <button class="btn2" onclick="exportCSV()">ğŸ“¤ ESPORTA EXCEL</button>
          <button class="btn2" onclick="clearAll()">ğŸ—‘ï¸ SVUOTA</button>
        </div>
      </div>
      <button class="btn" onclick="startWizard()">â• NUOVA SEDUTA</button>
    </section>

    <!-- STEP 1: INFERMIERE -->
    <section id="s1" class="hidden step-bg bg-nurse">
      <main>
        <div class="card">
          <div class="stepTitle">ğŸ§‘â€âš•ï¸ Identificazione infermiere</div>
          <div class="stepSub">Inserisci firma/sigla per tracciabilitÃ .</div>
          <div style="margin-top:12px">
            <label>Firma infermiere</label>
            <input id="nurse" placeholder="Es. M.R. / Maria Rossi">
          </div>
          <div class="kpi">
            <span class="pill" id="pillNurse">Firma: â€”</span>
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn2" onclick="go('home')">â†©ï¸ Esci</button>
            <button class="btn" onclick="nextFromNurse()">Avanti âœ</button>
          </div>
        </div>
      </main>
    </section>

    <!-- STEP 2: PAZIENTE -->
    <section id="s2" class="hidden step-bg bg-patient">
      <main>
        <div class="card">
          <div class="stepTitle">ğŸ§¾ Identificazione paziente</div>
          <div class="stepSub">Inserisci un ID (es. GR72).</div>
          <div style="margin-top:12px">
            <label>ID paziente</label>
            <input id="pid" placeholder="Es. GR72">
          </div>
          <div class="kpi">
            <span class="pill" id="pillPid">Paziente: â€”</span>
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn2" onclick="backTo('s1')">â¬…ï¸ Indietro</button>
            <button class="btn" onclick="nextFromPid()">Avanti âœ</button>
          </div>
        </div>
      </main>
    </section>

    <!-- STEP 3: ACCESSO -->
    <section id="s3" class="hidden step-bg bg-access">
      <main>
        <div class="card">
          <div class="stepTitle">ğŸ©¸ Selezione accesso</div>
          <div class="stepSub">Sce

